<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ç”»ãƒãƒ¼ãƒ B å¿˜å¹´ä¼šã‚¢ãƒ—ãƒª</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Reggae+One&family=Zen+Kaku+Gothic+New:wght@400;700&family=DotGothic16&display=swap" rel="stylesheet">
    <!-- QR Code Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --accent-color: #d4af37;
            --quiz-color: #3498db;
            --correct-color: #e74c3c;
            --box-color: #e67e22; /* ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”¨ */
            --card-bg: #1e1e1e;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Zen Kaku Gothic New', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overscroll-behavior: none;
            overflow-y: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æ˜ç¤ºçš„ã«è¨±å¯ */
        }

        /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        h1, h2, h3, .reg-font { font-family: 'Reggae One', serif; }
        .dot-font { font-family: 'DotGothic16', sans-serif; }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 10px 20px 300px 20px; /* ä¸Šéƒ¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å‰Šæ¸›ã€ä¸‹éƒ¨ã¯å›ºå®šè¦ç´ ç”¨ã«ç¢ºä¿ */
        }
        .hidden { display: none !important; }

        /* --- ç”»é¢åˆ‡ã‚Šæ›¿ãˆ --- */
        #view-setup, #view-host, #view-client { display: none; }
        
        /* --- Setupç”»é¢ --- */
        .setup-box {
            text-align: center;
            margin-top: 100px;
            padding: 40px;
            background: var(--card-bg);
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        .mode-btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            font-size: 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Reggae One', serif;
        }
        .btn-host { background: var(--accent-color); color: #000; }
        .btn-client { background: var(--quiz-color); color: #fff; }

        /* --- Hostç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–) --- */
        .host-header {
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
            margin-bottom: 15px; /* å‰Šæ¸› */
            padding-bottom: 5px; /* å‰Šæ¸› */
        }
        .host-header h1 { 
            margin: 0; 
            color: var(--accent-color); 
            text-shadow: 0 0 10px rgba(212,175,55,0.5); 
            font-size: 2rem; /* å°‘ã—å°ã•ã */
        }
        
        /* QRã‚³ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
        #qr-section {
            text-align: center;
            padding: 40px;
            background: #fff;
            color: #000;
            border-radius: 10px;
            margin-bottom: 40px;
        }
        #qr-section h2 { margin-top: 0; }
        #qrcode { margin: 20px auto; }
        .join-url { font-size: 1.2rem; word-break: break-all; color: #555; }

        /* ã‚¯ã‚¤ã‚ºã‚¨ãƒªã‚¢ (2ã‚«ãƒ©ãƒ ) */
        .quiz-layout { display: flex; gap: 20px; align-items: flex-start; }
        .quiz-left { flex: 2; }
        .quiz-right { flex: 1; min-width: 250px; }

        /* ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¨ãƒªã‚¢ (ãƒ‡ã‚¶ã‚¤ãƒ³ä¿®æ­£) */
        #blackbox-section {
            text-align: center;
            padding: 20px;
            border: 2px solid var(--box-color);
            border-radius: 15px;
            background: rgba(230, 126, 34, 0.05);
        }
        .bb-title { color: var(--box-color); font-size: 2rem; margin: 0 0 15px 0; text-shadow: 0 0 10px rgba(230, 126, 34, 0.5); }
        .bb-desc { font-size: 1.1rem; margin-bottom: 20px; }
        
        .bb-groups {
            display: flex; gap: 20px; justify-content: center; margin-bottom: 20px;
        }
        .bb-group {
            flex: 1; background: rgba(0,0,0,0.5); border: 1px solid var(--box-color);
            border-radius: 10px; padding: 10px;
        }
        .bb-group h3 { color: var(--box-color); margin: 0 0 5px 0; font-size: 1.3rem; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .bb-group p { font-size: 1.1rem; font-weight: bold; margin: 0; line-height: 1.4; }

        .bb-rules {
            text-align: left; display: inline-block; font-size: 1rem; line-height: 1.6;
            background: rgba(255,255,255,0.05); padding: 15px 30px; border-radius: 10px; margin-bottom: 15px;
        }
        .bb-rules li { margin-bottom: 5px; }
        .highlight { color: var(--box-color); font-weight: bold; font-size: 1.2em; }
        .warning { color: var(--correct-color); font-weight: bold; }

        .bb-footer {
            border-top: 1px solid #555; padding-top: 15px;
        }
        .open-call { font-size: 1.8rem; font-weight: bold; color: #fff; margin-bottom: 10px; font-family: 'Reggae One'; }
        .bb-points {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
        }
        .bb-point-item {
            background: #2c3e50; padding: 8px 15px; border-radius: 50px; font-weight: bold; font-size: 1rem;
            border: 1px solid var(--accent-color);
        }

        /* ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ»å•é¡Œ (ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–) */
        .quiz-meta {
            margin-bottom: 10px; /* å‰Šæ¸› */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        .media-box {
            width: 100%; 
            height: 25vh; /* ç”»é¢é«˜ã•ã®25%ã«è¨­å®š */
            min-height: 200px;
            max-height: 350px;
            background: #000;
            display: flex; justify-content: center; align-items: center;
            border: 1px solid #333; border-radius: 10px; margin-bottom: 15px;
        }
        .media-box img, .media-box video { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .question-text { 
            font-size: 1.5rem; /* å°‘ã—å°ã•ã */
            margin-bottom: 20px; /* å‰Šæ¸› */
            font-weight: bold; 
            line-height: 1.3; 
        }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-card {
            background: #333; padding: 15px; /* å‰Šæ¸› */
            border-radius: 10px;
            font-size: 1.3rem; /* å°‘ã—å°ã•ã */
            border: 2px solid #555; position: relative;
        }
        .option-card.correct {
            background: var(--correct-color); border-color: #ff0000; animation: pulse 1s infinite;
        }
        .option-card.fade { opacity: 0.3; }
        
        /* å‚åŠ è€…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ« (Hostå³å´) */
        .status-panel {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;
            border: 1px solid #444; max-height: 50vh; overflow-y: auto;
        }
        .status-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px; border-bottom: 1px solid #444;
        }
        .status-name { font-weight: bold; font-size: 1.1rem; }
        .status-info { display: flex; align-items: center; gap: 10px; }
        .status-mark { 
            font-size: 1.3rem; width: 30px; text-align: center; font-weight: bold; font-family: 'Reggae One';
        }
        .status-result { font-size: 1.3rem; }
        .status-answered { color: var(--quiz-color); } /* å›ç­”æ¸ˆã¿ */
        
        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        .control-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.9); border-top: 2px solid var(--accent-color);
            padding: 10px; display: flex; gap: 20px; justify-content: center; z-index: 1000;
            min-height: 60px; /* â˜…è¿½åŠ : ä¸­èº«ãŒç©ºã§ã‚‚é«˜ã•ã‚’ç¢ºä¿ */
            box-sizing: border-box; /* paddingã‚’å«ã‚ã‚‹ */
        }
        .ctrl-btn {
            padding: 8px 25px; font-size: 1.1rem; border-radius: 30px; border: none;
            cursor: pointer; font-family: 'Reggae One', serif; min-width: 120px;
        }
        .btn-prev { background: #555; color: #fff; min-width: 80px; } /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
        .btn-next { background: var(--accent-color); color: #000; }
        .btn-show { background: var(--quiz-color); color: #fff; }
        .btn-start { background: #e74c3c; color: #fff; font-size: 1.3rem; padding: 10px 40px; }
        .btn-reset { 
            background: #555; color: #fff; font-size: 0.9rem; 
            position:absolute; right: 15px; 
            top: 50%; transform: translateY(-50%); /* â˜…ä¿®æ­£: å‚ç›´ä¸­å¤®æƒãˆ */
            padding: 5px 10px; 
        }
        .btn-bot { 
            background: #2980b9; color: #fff; font-size: 0.9rem; 
            position:absolute; left: 15px; 
            top: 50%; transform: translateY(-50%); /* â˜…ä¿®æ­£: å‚ç›´ä¸­å¤®æƒãˆ */
            padding: 5px 10px;
            min-width: auto; /* ã‚µã‚¤ã‚ºã‚’ãƒªã‚»ãƒƒãƒˆ */
            z-index: 2000; /* æœ€å‰é¢ã« */
        }

        /* --- Clientç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .client-container {
            max-width: 600px; margin: 0 auto; padding: 20px; text-align: center;
            display: flex; flex-direction: column; height: 90vh;
        }
        
        /* åå‰å…¥åŠ› */
        .name-input-area { margin-top: 50px; }
        .name-input {
            width: 80%; padding: 15px; font-size: 1.2rem; margin: 20px 0;
            border-radius: 10px; border: none; text-align: center;
        }
        
        /* å¾…æ©Ÿç”»é¢ */
        .waiting-area { margin-top: 50px; }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #333;
            border-top: 5px solid var(--accent-color); border-radius: 50%;
            animation: spin 1s linear infinite; margin: 0 auto 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* å›ç­”ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .client-quiz-area {
            flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 20px;
        }
        .ans-btn-client {
            padding: 30px; font-size: 2rem; border-radius: 15px; border: 2px solid #555;
            background: #333; color: #fff; cursor: pointer; transition: all 0.2s;
            font-family: 'Reggae One', serif;
        }
        .ans-btn-client.selected {
            background: var(--quiz-color); border-color: #fff; transform: scale(1.05);
        }
        .ans-btn-client:disabled { opacity: 0.5; cursor: not-allowed; }

        /* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
        .client-reset-btn {
            margin-top: 20px; background: transparent; border: 1px solid #555; color: #555;
            padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
        }

        /* çµæœè¡¨ç¤º */
        .result-popup {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 2000;
        }
        .result-text { font-size: 4rem; font-weight: bold; margin-bottom: 20px; }
        .win { color: var(--correct-color); }
        .lose { color: #555; }

        /* ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ (Hostä¸‹éƒ¨) - ãƒ‰ãƒ©ãƒƒã‚°å¯¾å¿œç‰ˆ (ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–) */
        .host-scoreboard {
            position: fixed; bottom: 65px; /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´ */
            left: 0; width: 100%;
            background: rgba(30,30,30,0.95); z-index: 900;
            height: 150px; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé«˜ã•ã‚’ä½ã */
            display: flex; flex-direction: column;
            border-top: 1px solid #444;
        }
        .resize-handle {
            height: 15px; background: #333; cursor: row-resize;
            display: flex; justify-content: center; align-items: center;
        }
        .resize-bar { width: 50px; height: 4px; background: #666; border-radius: 2px; }
        
        .players-scroll {
            flex: 1; overflow-y: auto; padding: 10px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;
        }
        .p-card {
            background: #2c3e50; padding: 5px; border-radius: 8px; text-align: center;
            border: 1px solid #444;
        }
        .p-score { font-size: 1.5rem; color: var(--accent-color); font-weight: bold; }
        .p-name { font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .score-ctrls { display: flex; justify-content: center; gap: 3px; margin-top: 3px; }
        .mini-btn { padding: 3px 8px; font-size: 0.7rem; background: #444; border:none; color: #fff; border-radius: 4px; cursor: pointer; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231,76,60,0.7); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
    </style>
</head>
<body>

<!-- Firebase SDK (Modular) -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, onSnapshot, updateDoc, addDoc, getDocs, query, writeBatch, increment } 
    from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
    // ã“ã“ã«Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    const firebaseConfig = {
        apiKey: "AIzaSyAJKzF1FDRXUw98iZo3N3IZdt0sKdc-uxU",
        authDomain: "year-end-party-2025-teamb.firebaseapp.com",
        projectId: "year-end-party-2025-teamb",
        storageBucket: "year-end-party-2025-teamb.firebasestorage.app",
        messagingSenderId: "600737750250",
        appId: "1:600737750250:web:c5670ed8b6a5058b1e8b93"
    };
    // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

    // App Init
    let app, db;
    try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    } catch (e) {
        console.error("Firebase init error. Config might be missing.", e);
        alert("Firebaseã®è¨­å®šãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰å†…ã®configã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    }

    // Global State
    let currentUser = null; // { id, name }
    let currentGameState = null;
    let currentPlayerDocs = []; // Store docs for re-rendering
    
    // --- Quiz Data ---
    const quizData = [
        // 1. è¥¿å· (Q1, Q2)
        {
            presenter: "è¥¿å·ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œï¼ä¸€å•ç›®ãªã®ã§è‚©æ…£ã‚‰ã—ã§ã™ï¼é’æ£®æ—…è¡Œã§è¡Œã£ãŸé«˜å±±ç¨²è·ç¥ç¤¾ã§ã™ãŒé³¥å±…ã®æ•°ã¯ã„ãã¤ã§ã—ã‚‡ã†ã‹ï¼ï¼Ÿ",
            options: ["A. 1000æœ¬", "B. ç´„100æœ¬", "C. ç´„200æœ¬", "D. ç´„400æœ¬"],
            answerIndex: 2, // C
            mediaType: "image", 
            mediaSrc: "./aomori.jpg", // åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç”»åƒã‚’ç½®ã„ã¦ãã ã•ã„
            answerMediaSrc: "./aomori_syuugou.jpg" // ä¿®æ­£å®Œäº†
        },
        {
            presenter: "è¥¿å·ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ç§ã¯VTuberãŒå¥½ãã§ã™ã€‚ã‚¦ãƒ¡ãƒãƒ©ãŒCrazyRaccoonã¨ã‚³ãƒ©ãƒœã—ã¦CRã‚«ãƒƒãƒ—ã§SF6ã‚’ã‚„ã‚Šå§‹ã‚ãŸæ™‚ã‹ã‚‰èˆˆå‘³ãŒå‡ºã¦ã€æœ€è¿‘ã§ã¯Mad Town GTAãŒå¤§å¥½ç‰©ã§ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚‚è¶³ã‚’é‹ã‚“ã§ã„ã¾ã™ã€‚\nã•ã¦ï¼ç§ã®æ¨ã—ã¯èª°ã§ã—ã‚‡ã†ï¼ï¼Ÿ",
            options: ["A. æ©˜ã²ãªã®", "B. å¤©é¬¼ã·ã‚‹ã‚‹", "C. èµ¤è¦‹ã‹ã‚‹ã³", "D. ãƒ¡ãƒ¼ãƒ¡ãƒ³ãƒˆãƒ´ã‚¡ãƒ‹ã‚¿ã‚¹"],
            answerIndex: 1, // B
            mediaType: "image",
            mediaSrc: "./vtuber.jpg",
            answerMediaSrc: "./pururu_sf6.jpg" // ç¢ºèªï¼ˆå¤‰æ›´ãªã—ï¼‰
        },

        // 2. ã‚ã¹ã¡ã‚ƒã‚“ (Q3, Q4)
        {
            presenter: "ã‚ã¹ã¡ã‚ƒã‚“ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ã‚ã¹ã•ã‚“ã¯ã‚«ãƒ©ã‚ªã‚±å¥½ãã§æœ‰åã§ã™ãŒä»Šå¹´ã¯å…¨ç„¶è¡Œã‘ã¾ã›ã‚“ã§ã—ãŸä½•å›è¡Œã£ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ",
            options: ["A. 0å›", "B. 5å›", "C. 10å›", "D. 15å›"],
            answerIndex: 0, // A
            mediaType: "image",
            mediaSrc: "./Q3_1.jpg",
            answerMediaSrc: "./Q3_2.jpg"
        },
        {
            presenter: "ã‚ã¹ã¡ã‚ƒã‚“ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ã‚ã¹ã•ã‚“ã¯ãƒ‘ãƒãƒ³ã‚«ã‚¹ã§ã™ã€‚ä»Š1ç•ªé¢ç™½ã„ã¨æ€ã£ã¦ã„ã‚‹å°ã¯ï¼Ÿ",
            options: ["A. ç§˜å®ä¼", "B. LåŒ–ç‰©èª", "C. Lé˜²æŒ¯ã‚Š", "D. Lã‚¹ã‚¿ãƒ¼ãƒãƒŠãƒãƒŠ"],
            answerIndex: 2, // C
            mediaType: "image",
            mediaSrc: "./Q4_1.jpg",
            answerMediaSrc: "./Q4_2.jpg"
        },

        // 3. èµ¤å²¡å…ˆç”Ÿ (Q5, Q6) - ä»®ãƒ‡ãƒ¼ã‚¿
        {
            presenter: "èµ¤å²¡å…ˆç”Ÿã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ï¼ˆæº–å‚™ä¸­ï¼‰èµ¤å²¡å…ˆç”Ÿã®ç¬¬1å•ç›®ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚",
            options: ["A. é¸æŠè‚¢A", "B. é¸æŠè‚¢B", "C. é¸æŠè‚¢C", "D. é¸æŠè‚¢D"],
            answerIndex: 0,
            mediaType: "none",
            mediaSrc: ""
        },
        {
            presenter: "èµ¤å²¡å…ˆç”Ÿã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ï¼ˆæº–å‚™ä¸­ï¼‰èµ¤å²¡å…ˆç”Ÿã®ç¬¬2å•ç›®ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚",
            options: ["A. é¸æŠè‚¢A", "B. é¸æŠè‚¢B", "C. é¸æŠè‚¢C", "D. é¸æŠè‚¢D"],
            answerIndex: 0,
            mediaType: "none",
            mediaSrc: ""
        },

        // 4. ã‚†ã†ãã†ã•ã‚“ (Q7, Q8) - ä»®ãƒ‡ãƒ¼ã‚¿
        {
            presenter: "ã‚†ã†ãã†ã•ã‚“ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ï¼ˆæº–å‚™ä¸­ï¼‰ã‚†ã†ãã†ã•ã‚“ã®ç¬¬1å•ç›®ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚",
            options: ["A. é¸æŠè‚¢A", "B. é¸æŠè‚¢B", "C. é¸æŠè‚¢C", "D. é¸æŠè‚¢D"],
            answerIndex: 0,
            mediaType: "none",
            mediaSrc: ""
        },
        {
            presenter: "ã‚†ã†ãã†ã•ã‚“ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ï¼ˆæº–å‚™ä¸­ï¼‰ã‚†ã†ãã†ã•ã‚“ã®ç¬¬2å•ç›®ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚",
            options: ["A. é¸æŠè‚¢A", "B. é¸æŠè‚¢B", "C. é¸æŠè‚¢C", "D. é¸æŠè‚¢D"],
            answerIndex: 0,
            mediaType: "none",
            mediaSrc: ""
        },

        // 5. ã‚‚ã£ã¤ (Q9, Q10) - ä»®ãƒ‡ãƒ¼ã‚¿
        {
            presenter: "ã‚‚ã£ã¤ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ï¼ˆæº–å‚™ä¸­ï¼‰ã‚‚ã£ã¤ã®ç¬¬1å•ç›®ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚",
            options: ["A. é¸æŠè‚¢A", "B. é¸æŠè‚¢B", "C. é¸æŠè‚¢C", "D. é¸æŠè‚¢D"],
            answerIndex: 0,
            mediaType: "none",
            mediaSrc: ""
        },
        {
            presenter: "ã‚‚ã£ã¤ã‹ã‚‰ã®å‡ºé¡Œ",
            question: "ï¼ˆæº–å‚™ä¸­ï¼‰ã‚‚ã£ã¤ã®ç¬¬2å•ç›®ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚",
            options: ["A. é¸æŠè‚¢A", "B. é¸æŠè‚¢B", "C. é¸æŠè‚¢C", "D. é¸æŠè‚¢D"],
            answerIndex: 0,
            mediaType: "none",
            mediaSrc: ""
        }
    ];
    
    // DOM Elements
    const views = {
        setup: document.getElementById('view-setup'),
        host: document.getElementById('view-host'),
        client: document.getElementById('view-client')
    };

    // --- Boot Sequence ---
    window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const role = urlParams.get('role');

        if (role === 'host') {
            checkHostAuth();
        } else if (role === 'client') {
            showView('client');
            initClient();
        } else {
            showView('setup');
        }
    });

    function showView(name) {
        Object.values(views).forEach(el => el.style.display = 'none');
        views[name].style.display = 'block';
    }

    // --- Setup View Logic ---
    window.startAsHost = () => {
        const pass = prompt("Enter Host Password:");
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
        if(pass === "teamb") {
            const newUrl = window.location.href.split('?')[0] + '?role=host';
            window.location.href = newUrl;
        } else {
            alert("Wrong Password");
        }
    };
    
    window.startAsClient = () => {
        const newUrl = window.location.href.split('?')[0] + '?role=client';
        window.location.href = newUrl;
    };

    // --- Host Logic ---
    async function initHost() {
        showView('host');
        
        // QR Code Generation
        const clientUrl = window.location.href.split('?')[0] + '?role=client';
        new QRious({
            element: document.getElementById('qrcode'),
            value: clientUrl,
            size: 200
        });
        document.getElementById('join-url').textContent = clientUrl;

        // Listen to Players
        onSnapshot(collection(db, "bonenkai_2025_players"), (snapshot) => {
            currentPlayerDocs = snapshot.docs; // Global Store
            renderHostScoreboard(snapshot.docs);
            renderHostStatusPanel(snapshot.docs); // Trigger render
        });

        // Listen to GameState
        onSnapshot(doc(db, "bonenkai_2025", "gameState"), (docSnap) => {
            if (docSnap.exists()) {
                const state = docSnap.data();
                currentGameState = state;
                updateHostUI(state);
                renderHostStatusPanel(currentPlayerDocs); // Re-render status when state changes
            }
        });
    }

    function checkHostAuth() {
        initHost();
    }

    // Host Actions
    window.hostStartQuiz = async () => {
        await setDoc(doc(db, "bonenkai_2025", "gameState"), {
            phase: 'quiz',
            currentQIndex: 0,
            status: 'open'
        });
        resetPlayersAnswer();
    };

    window.hostNextQ = async () => {
        if (!currentGameState) return;
        const nextIdx = currentGameState.currentQIndex + 1;

        if (nextIdx >= quizData.length) {
            await updateDoc(doc(db, "bonenkai_2025", "gameState"), {
                phase: 'blackbox',
                status: 'open'
            });
            return;
        }
        
        await resetPlayersAnswer();
        await updateDoc(doc(db, "bonenkai_2025", "gameState"), {
            phase: 'quiz',
            currentQIndex: nextIdx,
            status: 'open'
        });
    };

    window.hostPrevQ = async () => {
        if (!currentGameState) return;
        
        if (currentGameState.phase === 'blackbox') {
            await updateDoc(doc(db, "bonenkai_2025", "gameState"), {
                phase: 'quiz',
                currentQIndex: quizData.length - 1, 
                status: 'open' 
            });
            return;
        }

        const prevIdx = currentGameState.currentQIndex - 1;
        
        if (prevIdx < 0) {
            if(confirm("QRã‚³ãƒ¼ãƒ‰ï¼ˆå¾…æ©Ÿï¼‰ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) {
                await updateDoc(doc(db, "bonenkai_2025", "gameState"), {
                    phase: 'entry',
                    currentQIndex: 0,
                    status: 'open'
                });
            }
            return;
        }

        await resetPlayersAnswer();
        await updateDoc(doc(db, "bonenkai_2025", "gameState"), {
            phase: 'quiz',
            currentQIndex: prevIdx,
            status: 'open'
        });
    };

    async function resetPlayersAnswer() {
        const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
        const batch = writeBatch(db);
        playersSnap.forEach(p => {
            batch.update(doc(db, "bonenkai_2025_players", p.id), { currentAnswer: null });
        });
        await batch.commit();
    }

    window.hostShowAnswer = async () => {
        if (!currentGameState) return;
        const currentIdx = currentGameState.currentQIndex;
        const data = quizData[currentIdx];
        
        // Lock game
        await updateDoc(doc(db, "bonenkai_2025", "gameState"), { status: 'closed' });

        // Calculate Scores
        const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
        const batch = writeBatch(db);
        
        playersSnap.forEach(p => {
            const pData = p.data();
            if (pData.currentAnswer === data.answerIndex) {
                const pRef = doc(db, "bonenkai_2025_players", p.id);
                batch.update(pRef, { 
                    score: increment(1) 
                });
            }
        });
        await batch.commit();
        
        highlightCorrectOption(data.answerIndex);
    };

    window.manualScore = async (id, delta) => {
        const pRef = doc(db, "bonenkai_2025_players", id);
        await updateDoc(pRef, {
            score: increment(delta)
        });
    };

    window.resetGame = async () => {
        if(confirm("ã€å±é™ºã€‘æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨å“¡ã®å‚åŠ ãƒ‡ãƒ¼ã‚¿ã¨ã‚¹ã‚³ã‚¢ãŒæ¶ˆãˆã€QRã‚³ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚")) {
            await setDoc(doc(db, "bonenkai_2025", "gameState"), {
                phase: 'entry',
                currentQIndex: 0,
                status: 'open'
            });
            const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
            const batch = writeBatch(db);
            playersSnap.forEach(p => {
                batch.delete(doc(db, "bonenkai_2025_players", p.id));
            });
            await batch.commit();
            location.reload();
        }
    };

    // --- TEST BOT LOGIC ---
    window.startBotTest = async () => {
        if(!confirm("ä»®æƒ³ãƒœãƒƒãƒˆã‚’10ä½“å‚åŠ ã•ã›ã¾ã™ã‹ï¼Ÿ\nï¼ˆæœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã¨æ··ã–ã‚‹ãŸã‚ã€ãƒªãƒãƒ¼ã‚µãƒ«æ™‚ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼‰")) return;
        
        const botNames = ["Bot-ç”°ä¸­", "Bot-ä½è—¤", "Bot-éˆ´æœ¨", "Bot-é«˜æ©‹", "Bot-ä¼Šè—¤", "Bot-æ¸¡è¾º", "Bot-å±±æœ¬", "Bot-ä¸­æ‘", "Bot-å°æ—", "Bot-åŠ è—¤"];
        
        // 1. Create Bots
        for(let name of botNames) {
            await addDoc(collection(db, "bonenkai_2025_players"), {
                name: name,
                score: 0,
                currentAnswer: null,
                isBot: true // Flag
            });
        }

        // 2. Start Bot Listener (Running in Host Browser)
        onSnapshot(doc(db, "bonenkai_2025", "gameState"), async (docSnap) => {
            const state = docSnap.data();
            if(state.phase === 'quiz' && state.status === 'open') {
                // Random delay answer
                setTimeout(async () => {
                    const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
                    playersSnap.forEach(async p => {
                        if(p.data().isBot && p.data().currentAnswer === null) {
                            const randomAns = Math.floor(Math.random() * 4);
                            await updateDoc(doc(db, "bonenkai_2025_players", p.id), {
                                currentAnswer: randomAns
                            });
                        }
                    });
                }, Math.random() * 3000 + 1000); // 1-4 sec delay
            }
        });
        
        alert("ãƒœãƒƒãƒˆ10åãŒå‚åŠ ã—ã¾ã—ãŸï¼ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã™ã‚‹ã¨è‡ªå‹•ã§å›ç­”ã—ã¾ã™ã€‚");
    };

    // Host UI Renderers
    function updateHostUI(state) {
        if (!state) return;

        if (state.phase === 'entry') {
            document.getElementById('qr-section').classList.remove('hidden');
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('blackbox-section').classList.add('hidden');
            document.getElementById('btn-prev').classList.add('hidden');
            document.getElementById('btn-show').classList.add('hidden');
            document.getElementById('btn-next').classList.add('hidden');
            return;
        }

        if (state.phase === 'blackbox') {
            document.getElementById('qr-section').classList.add('hidden');
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('blackbox-section').classList.remove('hidden');
            
            document.getElementById('btn-prev').classList.remove('hidden');
            document.getElementById('btn-show').classList.add('hidden');
            document.getElementById('btn-next').classList.add('hidden');
            return;
        }

        // Quiz
        document.getElementById('qr-section').classList.add('hidden');
        document.getElementById('quiz-section').classList.remove('hidden');
        document.getElementById('blackbox-section').classList.add('hidden');

        const data = quizData[state.currentQIndex];
        if (!data) return; 

        document.getElementById('q-count').textContent = `Q.${state.currentQIndex + 1}`;
        document.getElementById('q-count').dataset.index = state.currentQIndex;
        document.getElementById('q-presenter').textContent = data.presenter;
        document.getElementById('q-text').textContent = data.question;
        
        for(let i=0; i<4; i++) {
            const el = document.getElementById(`opt-${i}`);
            el.textContent = data.options[i];
            el.classList.remove('correct', 'fade');
        }

        // â˜… ç”»åƒåˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯
        const imgEl = document.getElementById('q-image');
        const phEl = document.getElementById('q-placeholder');
        
        let displayImgSrc = data.mediaSrc;
        // æ­£è§£è¡¨ç¤ºä¸­(closed) ã‹ã¤ æ­£è§£ç”»åƒ(answerMediaSrc)ãŒã‚ã‚‹å ´åˆ
        if (state.status === 'closed' && data.answerMediaSrc) {
            displayImgSrc = data.answerMediaSrc;
        }

        if (data.mediaType === 'image') {
            imgEl.src = displayImgSrc;
            imgEl.classList.remove('hidden');
            phEl.classList.add('hidden');
        } else {
            imgEl.classList.add('hidden');
            phEl.classList.remove('hidden');
        }

        // Buttons
        document.getElementById('btn-prev').classList.remove('hidden');
        if (state.status === 'open') {
            document.getElementById('btn-show').classList.remove('hidden');
            document.getElementById('btn-next').classList.add('hidden');
        } else {
            document.getElementById('btn-show').classList.add('hidden');
            document.getElementById('btn-next').classList.remove('hidden');
            highlightCorrectOption(data.answerIndex); 
        }
    }

    function renderHostStatusPanel(docs) {
        const container = document.getElementById('status-list');
        container.innerHTML = '';
        const answerMap = ['A', 'B', 'C', 'D'];
        
        // æ­£è§£ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
        let correctIdx = -1;
        let isClosed = false;
        if (currentGameState && currentGameState.phase === 'quiz' && quizData[currentGameState.currentQIndex]) {
            correctIdx = quizData[currentGameState.currentQIndex].answerIndex;
            isClosed = (currentGameState.status === 'closed');
        }

        docs.forEach(d => {
            const p = d.data();
            const div = document.createElement('div');
            div.className = 'status-row';
            
            let mark = 'ãƒ»';
            let answeredClass = '';
            let resultMark = '';

            if (p.currentAnswer !== null && p.currentAnswer !== undefined) {
                mark = answerMap[p.currentAnswer];
                answeredClass = 'status-answered';
                
                // â˜…æ­£è§£åˆ¤å®šè¡¨ç¤º
                if (isClosed) {
                    if (p.currentAnswer === correctIdx) {
                        resultMark = 'â­•ï¸';
                    } else {
                        resultMark = 'âŒ';
                    }
                }
            }

            div.innerHTML = `
                <span class="status-name">${p.name}</span>
                <div class="status-info">
                    <span class="status-mark ${answeredClass}">${mark}</span>
                    <span class="status-result">${resultMark}</span>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function renderHostScoreboard(docs) {
        const container = document.getElementById('players-scroll');
        const sorted = docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => b.score - a.score);
        
        container.innerHTML = '';
        sorted.forEach(p => {
            const div = document.createElement('div');
            div.className = 'p-card';
            div.innerHTML = `
                <div class="p-name">${p.name}</div>
                <div class="p-score">${p.score}</div>
                <div class="score-ctrls">
                    <button class="mini-btn" onclick="manualScore('${p.id}', 1)">+1</button>
                    <button class="mini-btn" onclick="manualScore('${p.id}', 3)">+3</button>
                    <button class="mini-btn" onclick="manualScore('${p.id}', -1)">-1</button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // --- Client Logic ---
    function initClient() {
        const savedId = localStorage.getItem('bonenkai_pid');
        if (savedId) {
            document.getElementById('login-area').classList.add('hidden');
            document.getElementById('client-main').classList.remove('hidden');
            currentUser = { id: savedId };
            startClientListeners();
        }
    }

    window.clientJoin = async () => {
        const name = document.getElementById('input-name').value;
        if (!name) return alert("åå‰ã‚’å…¥ã‚Œã¦ã­ï¼");

        const docRef = await addDoc(collection(db, "bonenkai_2025_players"), {
            name: name,
            score: 0,
            currentAnswer: null
        });
        
        localStorage.setItem('bonenkai_pid', docRef.id);
        currentUser = { id: docRef.id, name: name };
        
        document.getElementById('login-area').classList.add('hidden');
        document.getElementById('client-main').classList.remove('hidden');
        startClientListeners();
    };

    window.clientLogout = () => {
        if(confirm("åˆæœŸç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem('bonenkai_pid');
            location.reload();
        }
    };

    function startClientListeners() {
        onSnapshot(doc(db, "bonenkai_2025_players", currentUser.id), (snap) => {
            if (!snap.exists()) {
                localStorage.removeItem('bonenkai_pid');
                alert("ã‚²ãƒ¼ãƒ ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚ãƒˆãƒƒãƒ—ã«æˆ»ã‚Šã¾ã™ã€‚");
                location.reload();
            }
        });

        onSnapshot(doc(db, "bonenkai_2025", "gameState"), (snap) => {
            if(snap.exists()) {
                const state = snap.data();
                updateClientUI(state);
            }
        });
    }

    function updateClientUI(state) {
        const waitingArea = document.getElementById('client-waiting');
        const quizArea = document.getElementById('client-quiz');
        const blackboxArea = document.getElementById('client-blackbox');
        const statusText = document.getElementById('client-status');
        const resultPopup = document.getElementById('client-result');

        resultPopup.classList.add('hidden'); 

        if (state.phase === 'entry') {
            waitingArea.classList.remove('hidden');
            quizArea.classList.add('hidden');
            blackboxArea.classList.add('hidden');
            statusText.textContent = "é–‹å§‹å¾…ã¡ã§ã™...";
            return;
        }

        if (state.phase === 'blackbox') {
            waitingArea.classList.add('hidden');
            quizArea.classList.add('hidden');
            blackboxArea.classList.remove('hidden');
            statusText.textContent = "ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹";
            return;
        }

        waitingArea.classList.add('hidden');
        quizArea.classList.remove('hidden');
        blackboxArea.classList.add('hidden');

        const btns = document.querySelectorAll('.ans-btn-client');
        if (state.status === 'closed') {
            btns.forEach(b => b.disabled = true);
            statusText.textContent = "å›ç­”ç· ã‚åˆ‡ã‚Šï¼ç”»é¢ã‚’è¦‹ã¦ã­";
        } else {
            btns.forEach(b => {
                b.disabled = false;
                b.classList.remove('selected');
            });
            statusText.textContent = `Q.${state.currentQIndex + 1} å›ç­”ã‚’é¸æŠã—ã¦ã­`;
        }
    }

    window.clientSubmit = async (index) => {
        document.querySelectorAll('.ans-btn-client').forEach((b, i) => {
            if (i === index) b.classList.add('selected');
            else b.classList.remove('selected');
        });

        await updateDoc(doc(db, "bonenkai_2025_players", currentUser.id), {
            currentAnswer: index
        });
    };

    // --- Helpers ---
    function highlightCorrectOption(idx) {
        for(let i=0; i<4; i++) {
            const el = document.getElementById(`opt-${i}`);
            if (i === idx) el.classList.add('correct');
            else el.classList.add('fade');
        }
    }
</script>

<!-- UI Structure -->

<!-- SETUP SCREEN -->
<div id="view-setup">
    <div class="setup-box">
        <h1 style="color:var(--accent-color)">å½¹å‰²é¸æŠ</h1>
        <p>ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯ã©ã¡ã‚‰ã§ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ</p>
        <button class="mode-btn btn-host" onclick="startAsHost()">è¦ªæ©Ÿ (ã‚¹ã‚¯ãƒªãƒ¼ãƒ³)</button>
        <button class="mode-btn btn-client" onclick="startAsClient()">å­æ©Ÿ (å‚åŠ è€…)</button>
    </div>
</div>

<!-- HOST SCREEN -->
<div id="view-host">
    <div class="container">
        <header class="host-header">
            <h1>ä¼ç”»ãƒãƒ¼ãƒ B å‡ºã—ç‰© (è¦ªæ©Ÿ)</h1>
        </header>

        <!-- QR Entry Phase -->
        <div id="qr-section">
            <h2>å‚åŠ ç”¨QRã‚³ãƒ¼ãƒ‰</h2>
            <canvas id="qrcode"></canvas>
            <p class="join-url" id="join-url"></p>
            <p>ã‚¹ãƒãƒ›ã§èª­ã¿è¾¼ã‚“ã§åå‰ã‚’å…¥åŠ›ã—ã¦ã­ï¼</p>
            <button class="ctrl-btn btn-start" onclick="hostStartQuiz()">ã‚¯ã‚¤ã‚ºé–‹å§‹ï¼</button>
        </div>

        <!-- Quiz Phase -->
        <div id="quiz-section" class="hidden">
            <div class="quiz-layout">
                <div class="quiz-left">
                    <div class="quiz-meta">
                        <span id="q-presenter" class="reg-font" style="color:var(--accent-color); font-size:1.5rem;"></span>
                        <span id="q-count" class="reg-font" style="color:var(--quiz-color); font-size:2rem;"></span>
                    </div>
                    
                    <div class="media-box">
                        <img id="q-image" src="" class="hidden">
                        <div id="q-placeholder" style="color:#666;">(NO IMAGE)</div>
                    </div>

                    <div id="q-text" class="question-text"></div>

                    <div class="options-grid">
                        <div class="option-card" id="opt-0"></div>
                        <div class="option-card" id="opt-1"></div>
                        <div class="option-card" id="opt-2"></div>
                        <div class="option-card" id="opt-3"></div>
                    </div>
                </div>

                <!-- Status Panel (Right) -->
                <div class="quiz-right">
                    <h3 style="color:#888; border-bottom:1px solid #444; padding-bottom:5px;">å›ç­”çŠ¶æ³</h3>
                    <div class="status-panel" id="status-list">
                        <!-- Dynamic -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Black Box Phase (Updated Design) -->
        <div id="blackbox-section" class="hidden">
            <h2 class="bb-title">ç®±ã®ä¸­èº«ã¯ãªã‚“ã ã‚ãªï¼Ÿ - ææ€–ã®ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹</h2>
            <div class="bb-content">
                <p class="bb-desc">å•é¡ŒãŒ2å•ã‚ã‚Šã€äºŒæ‰‹ã«åˆ†ã‹ã‚Œã¦å‚åŠ ã—ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚</p>
                <div class="bb-groups">
                    <div class="bb-group">
                        <h3>1å•ç›®</h3>
                        <p>RENã¡ã‚ƒã‚“ã€å®‰é”ã•ã‚“ã€ã•ã¨ã—</p>
                    </div>
                    <div class="bb-group">
                        <h3>2å•ç›®</h3>
                        <p>ãŠã£ãŸã‚“ã€å°ç”°ã¡ã‚ƒã‚“ã€ã¨ã—ãã‚“ã€ã‚ˆã†ã¡ã‚ƒã‚“</p>
                    </div>
                </div>
                <div class="bb-rules">
                    <ul>
                        <li>ãƒ¤ã‚¸å¤§æ­“è¿ã§ã™ãŒã€è¦‹ã¦ã‚‹æ–¹ã¯æ­£è§£ã‚’è¨€ã‚ãªã„ã‚ˆã†ã«ï½—</li>
                        <li>ä¸€äººãšã¤ç®±ã«æ‰‹ã‚’å…¥ã‚Œã¦ç¢ºèªã—ã¾ã™ï¼š<span class="highlight">åˆ¶é™æ™‚é–“10ç§’</span></li>
                        <li>ã‚°ãƒ«ãƒ¼ãƒ—å…¨å“¡ãŒç¢ºèªã—ãŸã‚‰ç”»ç”¨ç´™ã«ãƒšãƒ³ã§å›ç­”ã‚’æ›¸ãã¾ã™</li>
                        <li><span class="warning">æ³¨æ„ï¼šå€‹äººæˆ¦ãªã®ã§å›ç­”æ™‚ã«ç›¸è«‡ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„</span></li>
                    </ul>
                </div>
                <div class="bb-footer">
                    <p class="open-call">ä¸€æ–‰ã«å›ç­”ã‚ªãƒ¼ãƒ—ãƒ³ï¼</p>
                    <div class="bb-points">
                        <span class="bb-point-item">ãƒ‰ãƒ³ãƒ”ã‚·ãƒ£æ­£è§£ï¼ï¼š3ç‚¹</span>
                        <span class="bb-point-item">ãŠã—ã„ï¼ï¼š1ç‚¹</span>
                        <span class="bb-point-item">ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æœ€é«˜ï¼ï¼š1ç‚¹</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scoreboard (Fixed Bottom) -->
        <div class="host-scoreboard" id="host-scoreboard">
            <div class="resize-handle"><div class="resize-bar"></div></div>
            <div class="players-scroll" id="players-scroll">
                <!-- Dynamic Player Cards -->
            </div>
        </div>

        <!-- Controls (Fixed Bottom Overlay) -->
        <div class="control-bar" id="ctrl-bar">
            <button class="ctrl-btn btn-bot" onclick="startBotTest()">ğŸ¤– TEST:10åå‚åŠ </button>
            <button id="btn-prev" class="ctrl-btn btn-prev hidden" onclick="hostPrevQ()">â† å‰ã¸</button>
            <button id="btn-show" class="ctrl-btn btn-show hidden" onclick="hostShowAnswer()">æ­£è§£ã‚’è¡¨ç¤º</button>
            <button id="btn-next" class="ctrl-btn btn-next hidden" onclick="hostNextQ()">æ¬¡ã®å•é¡Œã¸</button>
            <button class="ctrl-btn btn-reset" onclick="resetGame()">RESET</button>
        </div>
    </div>
</div>

<!-- CLIENT SCREEN -->
<div id="view-client">
    <div class="client-container">
        <h1 class="reg-font" style="color:var(--accent-color);">å‚åŠ ç”»é¢</h1>

        <!-- Login -->
        <div id="login-area" class="name-input-area">
            <p>åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            <input type="text" id="input-name" class="name-input" placeholder="ä¾‹: ãŸã‹ã—">
            <button class="mode-btn btn-client" onclick="clientJoin()">å‚åŠ ã™ã‚‹ï¼</button>
        </div>

        <!-- Waiting / Game -->
        <div id="client-main" class="hidden">
            <h2 id="client-status" style="margin-bottom:30px;"></h2>
            
            <div id="client-waiting" class="waiting-area">
                <div class="spinner"></div>
                <p>è¦ªæ©ŸãŒé–‹å§‹ã™ã‚‹ã®ã‚’å¾…ã£ã¦ã„ã¾ã™...</p>
                <button class="client-reset-btn" onclick="clientLogout()">åå‰å…¥åŠ›ã«æˆ»ã‚‹</button>
            </div>

            <div id="client-quiz" class="client-quiz-area hidden">
                <button class="ans-btn-client" onclick="clientSubmit(0)">A</button>
                <button class="ans-btn-client" onclick="clientSubmit(1)">B</button>
                <button class="ans-btn-client" onclick="clientSubmit(2)">C</button>
                <button class="ans-btn-client" onclick="clientSubmit(3)">D</button>
            </div>

            <div id="client-blackbox" class="waiting-area hidden">
                <h3 style="color:var(--box-color); font-size:2rem;">ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹<br>é–‹å‚¬ä¸­ï¼</h3>
                <p>å‰æ–¹ã®ç”»é¢ã¨å®Ÿæ¼”ã«æ³¨ç›®ã—ã¦ã­ï¼</p>
            </div>
            
            <div id="client-result" class="result-popup hidden">
                <div class="result-text win">â­•ï¸ æ­£è§£ï¼</div>
            </div>
        </div>
    </div>
</div>

<script>
    // Scoreboard Resize Logic
    const handle = document.querySelector('.resize-handle');
    const board = document.getElementById('host-scoreboard');
    let startY, startH;
    
    handle.addEventListener('mousedown', initDrag);
    handle.addEventListener('touchstart', initDrag);

    function initDrag(e) {
        startY = e.touches ? e.touches[0].clientY : e.clientY;
        startH = parseInt(window.getComputedStyle(board).height);
        document.addEventListener('mousemove', doDrag);
        document.addEventListener('touchmove', doDrag);
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
    }

    function doDrag(e) {
        const y = e.touches ? e.touches[0].clientY : e.clientY;
        const newH = startH + (startY - y);
        if(newH > 100 && newH < 600) board.style.height = newH + 'px';
    }

    function stopDrag() {
        document.removeEventListener('mousemove', doDrag);
        document.removeEventListener('touchmove', doDrag);
    }
</script>

</body>
</html>
