<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企画チームB 忘年会アプリ</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Reggae+One&family=Zen+Kaku+Gothic+New:wght@400;700&family=DotGothic16&display=swap" rel="stylesheet">
    <!-- QR Code Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --accent-color: #d4af37;
            --quiz-color: #3498db;
            --correct-color: #e74c3c;
            --card-bg: #1e1e1e;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Zen Kaku Gothic New', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overscroll-behavior: none;
        }

        /* 共通スタイル */
        h1, h2, .reg-font { font-family: 'Reggae One', serif; }
        .dot-font { font-family: 'DotGothic16', sans-serif; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }

        /* --- 画面切り替え --- */
        #view-setup, #view-host, #view-client { display: none; }
        
        /* --- Setup画面 --- */
        .setup-box {
            text-align: center;
            margin-top: 100px;
            padding: 40px;
            background: var(--card-bg);
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        .mode-btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            font-size: 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Reggae One', serif;
        }
        .btn-host { background: var(--accent-color); color: #000; }
        .btn-client { background: var(--quiz-color); color: #fff; }

        /* --- Host画面レイアウト --- */
        .host-header {
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .host-header h1 { margin: 0; color: var(--accent-color); text-shadow: 0 0 10px rgba(212,175,55,0.5); }
        
        /* QRコードエリア */
        #qr-section {
            text-align: center;
            padding: 40px;
            background: #fff;
            color: #000;
            border-radius: 10px;
            margin-bottom: 40px;
        }
        #qr-section h2 { margin-top: 0; }
        #qrcode { margin: 20px auto; }
        .join-url { font-size: 1.2rem; word-break: break-all; color: #555; }

        /* クイズエリア (2カラム) */
        .quiz-layout { display: flex; gap: 30px; align-items: flex-start; }
        .quiz-left { flex: 2; }
        .quiz-right { flex: 1; min-width: 300px; }

        /* メディア・問題 */
        .media-box {
            width: 100%; height: 350px; background: #000;
            display: flex; justify-content: center; align-items: center;
            border: 1px solid #333; border-radius: 10px; margin-bottom: 20px;
        }
        .media-box img, .media-box video { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .question-text { font-size: 1.8rem; margin-bottom: 30px; font-weight: bold; line-height: 1.4; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-card {
            background: #333; padding: 20px; border-radius: 10px;
            font-size: 1.5rem; border: 2px solid #555; position: relative;
        }
        .option-card.correct {
            background: var(--correct-color); border-color: #ff0000; animation: pulse 1s infinite;
        }
        .option-card.fade { opacity: 0.3; }
        
        /* 参加者ステータスパネル (Host右側) */
        .status-panel {
            background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px;
            border: 1px solid #444; max-height: 600px; overflow-y: auto;
        }
        .status-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; border-bottom: 1px solid #444;
        }
        .status-name { font-weight: bold; font-size: 1.2rem; }
        .status-mark { font-size: 1.5rem; width: 40px; text-align: center; }
        .status-answered { color: var(--quiz-color); } /* 回答済み */
        
        /* コントロールバー */
        .control-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.9); border-top: 2px solid var(--accent-color);
            padding: 15px; display: flex; gap: 20px; justify-content: center; z-index: 1000;
        }
        .ctrl-btn {
            padding: 10px 30px; font-size: 1.2rem; border-radius: 30px; border: none;
            cursor: pointer; font-family: 'Reggae One', serif; min-width: 150px;
        }
        .btn-next { background: var(--accent-color); color: #000; }
        .btn-show { background: var(--quiz-color); color: #fff; }
        .btn-start { background: #e74c3c; color: #fff; font-size: 1.5rem; padding: 15px 50px; }
        .btn-reset { background: #555; color: #fff; font-size: 1rem; position:absolute; right: 20px; top: 20px; padding: 10px; }

        /* --- Client画面レイアウト --- */
        .client-container {
            max-width: 600px; margin: 0 auto; padding: 20px; text-align: center;
            display: flex; flex-direction: column; height: 90vh;
        }
        
        /* 名前入力 */
        .name-input-area { margin-top: 50px; }
        .name-input {
            width: 80%; padding: 15px; font-size: 1.2rem; margin: 20px 0;
            border-radius: 10px; border: none; text-align: center;
        }
        
        /* 待機画面 */
        .waiting-area { margin-top: 50px; }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #333;
            border-top: 5px solid var(--accent-color); border-radius: 50%;
            animation: spin 1s linear infinite; margin: 0 auto 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* 回答ボタンエリア */
        .client-quiz-area {
            flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 20px;
        }
        .ans-btn-client {
            padding: 30px; font-size: 2rem; border-radius: 15px; border: 2px solid #555;
            background: #333; color: #fff; cursor: pointer; transition: all 0.2s;
            font-family: 'Reggae One', serif;
        }
        .ans-btn-client.selected {
            background: var(--quiz-color); border-color: #fff; transform: scale(1.05);
        }
        .ans-btn-client:disabled { opacity: 0.5; cursor: not-allowed; }

        /* 結果表示 */
        .result-popup {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 2000;
        }
        .result-text { font-size: 4rem; font-weight: bold; margin-bottom: 20px; }
        .win { color: var(--correct-color); }
        .lose { color: #555; }

        /* スコアボード (Host下部) - ドラッグ対応版 */
        .host-scoreboard {
            position: fixed; bottom: 80px; left: 0; width: 100%;
            background: rgba(30,30,30,0.95); z-index: 900;
            height: 200px; display: flex; flex-direction: column;
            border-top: 1px solid #444;
        }
        .resize-handle {
            height: 20px; background: #333; cursor: row-resize;
            display: flex; justify-content: center; align-items: center;
        }
        .resize-bar { width: 50px; height: 4px; background: #666; border-radius: 2px; }
        
        .players-scroll {
            flex: 1; overflow-y: auto; padding: 10px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;
        }
        .p-card {
            background: #2c3e50; padding: 10px; border-radius: 8px; text-align: center;
            border: 1px solid #444;
        }
        .p-score { font-size: 2rem; color: var(--accent-color); font-weight: bold; }
        .p-name { font-size: 1rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .score-ctrls { display: flex; justify-content: center; gap: 5px; margin-top: 5px; }
        .mini-btn { padding: 5px 10px; font-size: 0.8rem; background: #444; border:none; color: #fff; border-radius: 4px; cursor: pointer; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231,76,60,0.7); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
    </style>
</head>
<body>

<!-- Firebase SDK (Modular) -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, onSnapshot, updateDoc, addDoc, getDocs, query, writeBatch, increment } 
    from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
    // ここにFirebaseプロジェクトの設定を貼り付けてください
    const firebaseConfig = {
        apiKey: "AIzaSyAJKzF1FDRXUw98iZo3N3IZdt0sKdc-uxU",
        authDomain: "year-end-party-2025-teamb.firebaseapp.com",
        projectId: "year-end-party-2025-teamb",
        storageBucket: "year-end-party-2025-teamb.firebasestorage.app",
        messagingSenderId: "600737750250",
        appId: "1:600737750250:web:c5670ed8b6a5058b1e8b93"
    };
    // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★

    // App Init
    let app, db;
    try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    } catch (e) {
        console.error("Firebase init error. Config might be missing.", e);
        alert("Firebaseの設定が正しくありません。コード内のconfigを確認してください。");
    }

    // Global State
    let currentUser = null; // { id, name }
    
    // --- Quiz Data ---
    const quizData = [
        {
            presenter: "赤岡先生からの出題",
            question: "第1問：今年、赤岡先生がこっそり始めた趣味はどれでしょう？",
            options: ["A. ソロキャンプ", "B. バイオリン", "C. ポケモンカード", "D. 筋トレ"],
            answerIndex: 0, 
            mediaType: "image", 
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q1+Image"
        },
        {
            presenter: "赤岡先生からの出題",
            question: "第2問：赤岡先生が今年一番高かった買い物は？",
            options: ["A. ドラム式洗濯機", "B. 高級腕時計", "C. 車の修理代", "D. 仮想通貨"],
            answerIndex: 2,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q2+Image"
        },
        {
            presenter: "もっつからの出題",
            question: "第3問：もっつが最近ハマっているコンビニスイーツは？",
            options: ["A. ファミマのフラッペ", "B. ローソンのバスチー", "C. セブンのカヌレ", "D. ミニストップのソフト"],
            answerIndex: 1,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q3+Image"
        },
        {
            presenter: "もっつからの出題",
            question: "第4問：もっつが今年行った旅行先で一番良かった場所は？",
            options: ["A. 北海道", "B. 沖縄", "C. 台湾", "D. 近所のスーパー銭湯"],
            answerIndex: 0,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q4+Image"
        },
        {
            presenter: "西川からの出題",
            question: "第5問：西川が最近やらかした最大の失敗は？",
            options: ["A. 財布を落とした", "B. 会議で寝た", "C. 終電を逃して歩いて帰宅", "D. 料理でボヤ騒ぎ"],
            answerIndex: 2,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q5+Image"
        },
        {
            presenter: "西川からの出題",
            question: "第6問：西川が来年挑戦したいことは？",
            options: ["A. フルマラソン", "B. 英語学習", "C. 婚活", "D. YouTuberデビュー"],
            answerIndex: 0,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q6+Image"
        },
        {
            presenter: "祐三さんからの出題",
            question: "第7問：祐三さんが今年一番食べたラーメンの回数は？",
            options: ["A. 50回", "B. 100回", "C. 150回", "D. 365回"],
            answerIndex: 1,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q7+Image"
        },
        {
            presenter: "祐三さんからの出題",
            question: "第8問：祐三さんの今のスマホの待ち受け画面は？",
            options: ["A. 飼い猫", "B. 愛車", "C. 初期設定のまま", "D. 好きなアイドル"],
            answerIndex: 3,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q8+Image"
        },
        {
            presenter: "あべちゃんからの出題",
            question: "第9問：あべちゃんが今年一番感動した映画は？",
            options: ["A. ゴジラ-1.0", "B. 君たちはどう生きるか", "C. トップガン(家で見た)", "D. アンパンマン"],
            answerIndex: 0,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q9+Image"
        },
        {
            presenter: "あべちゃんからの出題",
            question: "第10問：あべちゃんからのメッセージ。「みんなに一言！」",
            options: ["A. お金貸して", "B. 愛してるぜ", "C. 健康第一", "D. 飲みに行こう"],
            answerIndex: 2,
            mediaType: "image",
            mediaSrc: "https://placehold.co/600x400/1e1e1e/d4af37?text=Q10+Image"
        }
    ];
    
    // DOM Elements
    const views = {
        setup: document.getElementById('view-setup'),
        host: document.getElementById('view-host'),
        client: document.getElementById('view-client')
    };

    // --- Boot Sequence ---
    window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const role = urlParams.get('role');

        if (role === 'host') {
            checkHostAuth();
        } else if (role === 'client') {
            showView('client');
            initClient();
        } else {
            showView('setup');
        }
    });

    function showView(name) {
        Object.values(views).forEach(el => el.style.display = 'none');
        views[name].style.display = 'block';
    }

    // --- Setup View Logic ---
    window.startAsHost = () => {
        const pass = prompt("Enter Host Password:");
        if(pass === "musyokutensei12manmaketa") {
            const newUrl = window.location.href.split('?')[0] + '?role=host';
            window.location.href = newUrl;
        } else {
            alert("Wrong Password");
        }
    };
    
    window.startAsClient = () => {
        const newUrl = window.location.href.split('?')[0] + '?role=client';
        window.location.href = newUrl;
    };

    // --- Host Logic ---
    async function initHost() {
        showView('host');
        
        // QR Code Generation
        const clientUrl = window.location.href.split('?')[0] + '?role=client';
        new QRious({
            element: document.getElementById('qrcode'),
            value: clientUrl,
            size: 200
        });
        document.getElementById('join-url').textContent = clientUrl;

        // Reset Game State
        await setDoc(doc(db, "bonenkai_2025", "gameState"), {
            phase: 'entry', // entry, quiz, result
            currentQIndex: 0,
            status: 'open' // open, closed
        });

        // Listen to Players
        onSnapshot(collection(db, "bonenkai_2025_players"), (snapshot) => {
            renderHostScoreboard(snapshot.docs);
            renderHostStatusPanel(snapshot.docs);
        });

        // Listen to GameState
        onSnapshot(doc(db, "bonenkai_2025", "gameState"), (docSnap) => {
            const state = docSnap.data();
            updateHostUI(state);
        });
    }

    function checkHostAuth() {
        initHost();
    }

    // Host Actions
    window.hostStartQuiz = async () => {
        await updateDoc(doc(db, "bonenkai_2025", "gameState"), {
            phase: 'quiz',
            currentQIndex: 0,
            status: 'open'
        });
        document.getElementById('qr-section').classList.add('hidden');
        document.getElementById('quiz-section').classList.remove('hidden');
    };

    window.hostNextQ = async () => {
        const stateRef = doc(db, "bonenkai_2025", "gameState");
        const currentIdx = parseInt(document.getElementById('q-count').dataset.index || 0);
        
        // Reset all players' answers
        const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
        const batch = writeBatch(db);
        playersSnap.forEach(p => {
            batch.update(doc(db, "bonenkai_2025_players", p.id), { currentAnswer: null });
        });
        await batch.commit();

        await updateDoc(stateRef, {
            currentQIndex: currentIdx + 1,
            status: 'open'
        });
    };

    window.hostShowAnswer = async () => {
        const currentIdx = parseInt(document.getElementById('q-count').dataset.index || 0);
        const data = quizData[currentIdx];
        
        // Lock game
        await updateDoc(doc(db, "bonenkai_2025", "gameState"), { status: 'closed' });

        // Calculate Scores
        const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
        const batch = writeBatch(db);
        
        playersSnap.forEach(p => {
            const pData = p.data();
            if (pData.currentAnswer === data.answerIndex) {
                const pRef = doc(db, "bonenkai_2025_players", p.id);
                batch.update(pRef, { 
                    score: increment(1) 
                });
            }
        });
        await batch.commit();
        
        highlightCorrectOption(data.answerIndex);
        
        document.getElementById('btn-show').classList.add('hidden');
        document.getElementById('btn-next').classList.remove('hidden');
    };

    // 手動スコア調整（Host下部のボタン）
    window.manualScore = async (id, delta) => {
        const pRef = doc(db, "bonenkai_2025_players", id);
        await updateDoc(pRef, {
            score: increment(delta)
        });
    };

    window.resetGame = async () => {
        if(confirm("本当にリセットしますか？参加者もスコアも全て消えます。")) {
            // ゲーム状態リセット
            await setDoc(doc(db, "bonenkai_2025", "gameState"), {
                phase: 'entry',
                currentQIndex: 0,
                status: 'open'
            });
            // プレイヤー全削除
            const playersSnap = await getDocs(collection(db, "bonenkai_2025_players"));
            const batch = writeBatch(db);
            playersSnap.forEach(p => {
                batch.delete(doc(db, "bonenkai_2025_players", p.id));
            });
            await batch.commit();
            location.reload();
        }
    };

    // Host UI Renderers
    function updateHostUI(state) {
        if (!state) return;

        if (state.phase === 'entry') {
            document.getElementById('qr-section').classList.remove('hidden');
            document.getElementById('quiz-section').classList.add('hidden');
            return;
        }

        const data = quizData[state.currentQIndex];
        if (!data) return; 

        document.getElementById('q-count').textContent = `Q.${state.currentQIndex + 1}`;
        document.getElementById('q-count').dataset.index = state.currentQIndex;
        document.getElementById('q-presenter').textContent = data.presenter;
        document.getElementById('q-text').textContent = data.question;
        
        for(let i=0; i<4; i++) {
            const el = document.getElementById(`opt-${i}`);
            el.textContent = data.options[i];
            el.classList.remove('correct', 'fade');
        }

        const imgEl = document.getElementById('q-image');
        const phEl = document.getElementById('q-placeholder');
        if (data.mediaType === 'image') {
            imgEl.src = data.mediaSrc;
            imgEl.classList.remove('hidden');
            phEl.classList.add('hidden');
        } else {
            imgEl.classList.add('hidden');
            phEl.classList.remove('hidden');
        }

        if (state.status === 'open') {
            document.getElementById('btn-show').classList.remove('hidden');
            document.getElementById('btn-next').classList.add('hidden');
        }
    }

    function renderHostStatusPanel(docs) {
        const container = document.getElementById('status-list');
        container.innerHTML = '';
        docs.forEach(d => {
            const p = d.data();
            const div = document.createElement('div');
            div.className = 'status-row';
            const hasAnswered = p.currentAnswer !== null && p.currentAnswer !== undefined;
            div.innerHTML = `
                <span class="status-name">${p.name}</span>
                <span class="status-mark ${hasAnswered ? 'status-answered' : ''}">
                    ${hasAnswered ? '●' : '・'}
                </span>
            `;
            container.appendChild(div);
        });
    }

    function renderHostScoreboard(docs) {
        const container = document.getElementById('players-scroll');
        const sorted = docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => b.score - a.score);
        
        container.innerHTML = '';
        sorted.forEach(p => {
            const div = document.createElement('div');
            div.className = 'p-card';
            div.innerHTML = `
                <div class="p-name">${p.name}</div>
                <div class="p-score">${p.score}</div>
                <div class="score-ctrls">
                    <button class="mini-btn" onclick="manualScore('${p.id}', 1)">+1</button>
                    <button class="mini-btn" onclick="manualScore('${p.id}', 3)">+3</button>
                    <button class="mini-btn" onclick="manualScore('${p.id}', -1)">-1</button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // --- Client Logic ---
    function initClient() {
        const savedId = localStorage.getItem('bonenkai_pid');
        if (savedId) {
            document.getElementById('login-area').classList.add('hidden');
            document.getElementById('client-main').classList.remove('hidden');
            currentUser = { id: savedId };
            startClientListeners();
        }
    }

    window.clientJoin = async () => {
        const name = document.getElementById('input-name').value;
        if (!name) return alert("名前を入れてね！");

        const docRef = await addDoc(collection(db, "bonenkai_2025_players"), {
            name: name,
            score: 0,
            currentAnswer: null
        });
        
        localStorage.setItem('bonenkai_pid', docRef.id);
        currentUser = { id: docRef.id, name: name };
        
        document.getElementById('login-area').classList.add('hidden');
        document.getElementById('client-main').classList.remove('hidden');
        startClientListeners();
    };

    function startClientListeners() {
        onSnapshot(doc(db, "bonenkai_2025", "gameState"), (snap) => {
            if(snap.exists()) {
                const state = snap.data();
                updateClientUI(state);
            }
        });
    }

    function updateClientUI(state) {
        const waitingArea = document.getElementById('client-waiting');
        const quizArea = document.getElementById('client-quiz');
        const statusText = document.getElementById('client-status');
        const resultPopup = document.getElementById('client-result');

        resultPopup.classList.add('hidden'); 

        if (state.phase === 'entry') {
            waitingArea.classList.remove('hidden');
            quizArea.classList.add('hidden');
            statusText.textContent = "開始待ちです...";
            return;
        }

        waitingArea.classList.add('hidden');
        quizArea.classList.remove('hidden');

        const btns = document.querySelectorAll('.ans-btn-client');
        if (state.status === 'closed') {
            btns.forEach(b => b.disabled = true);
            statusText.textContent = "回答締め切り！画面を見てね";
        } else {
            btns.forEach(b => {
                b.disabled = false;
                b.classList.remove('selected');
            });
            statusText.textContent = `Q.${state.currentQIndex + 1} 回答を選択してね`;
        }
    }

    window.clientSubmit = async (index) => {
        document.querySelectorAll('.ans-btn-client').forEach((b, i) => {
            if (i === index) b.classList.add('selected');
            else b.classList.remove('selected');
        });

        await updateDoc(doc(db, "bonenkai_2025_players", currentUser.id), {
            currentAnswer: index
        });
    };

    // --- Helpers ---
    function highlightCorrectOption(idx) {
        for(let i=0; i<4; i++) {
            const el = document.getElementById(`opt-${i}`);
            if (i === idx) el.classList.add('correct');
            else el.classList.add('fade');
        }
    }
</script>

<!-- UI Structure -->

<!-- SETUP SCREEN -->
<div id="view-setup">
    <div class="setup-box">
        <h1 style="color:var(--accent-color)">役割選択</h1>
        <p>このデバイスはどちらで使用しますか？</p>
        <button class="mode-btn btn-host" onclick="startAsHost()">親機 (スクリーン)</button>
        <button class="mode-btn btn-client" onclick="startAsClient()">子機 (参加者)</button>
    </div>
</div>

<!-- HOST SCREEN -->
<div id="view-host">
    <div class="container">
        <header class="host-header">
            <h1>企画チームB 出し物 (親機)</h1>
        </header>

        <!-- QR Entry Phase -->
        <div id="qr-section">
            <h2>参加用QRコード</h2>
            <canvas id="qrcode"></canvas>
            <p class="join-url" id="join-url"></p>
            <p>スマホで読み込んで名前を入力してね！</p>
            <button class="ctrl-btn btn-start" onclick="hostStartQuiz()">クイズ開始！</button>
        </div>

        <!-- Quiz Phase -->
        <div id="quiz-section" class="hidden">
            <div class="quiz-layout">
                <div class="quiz-left">
                    <div class="quiz-meta">
                        <span id="q-presenter" class="reg-font" style="color:var(--accent-color); font-size:1.5rem;"></span>
                        <span id="q-count" class="reg-font" style="color:var(--quiz-color); font-size:2rem;"></span>
                    </div>
                    
                    <div class="media-box">
                        <img id="q-image" src="" class="hidden">
                        <div id="q-placeholder" style="color:#666;">(NO IMAGE)</div>
                    </div>

                    <div id="q-text" class="question-text"></div>

                    <div class="options-grid">
                        <div class="option-card" id="opt-0"></div>
                        <div class="option-card" id="opt-1"></div>
                        <div class="option-card" id="opt-2"></div>
                        <div class="option-card" id="opt-3"></div>
                    </div>
                </div>

                <!-- Status Panel (Right) -->
                <div class="quiz-right">
                    <h3 style="color:#888; border-bottom:1px solid #444; padding-bottom:5px;">回答状況</h3>
                    <div class="status-panel" id="status-list">
                        <!-- Dynamic -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Scoreboard (Fixed Bottom) -->
        <div class="host-scoreboard" id="host-scoreboard">
            <div class="resize-handle"><div class="resize-bar"></div></div>
            <div class="players-scroll" id="players-scroll">
                <!-- Dynamic Player Cards -->
            </div>
        </div>

        <!-- Controls (Fixed Bottom Overlay) -->
        <div class="control-bar" id="ctrl-bar">
            <button id="btn-show" class="ctrl-btn btn-show hidden" onclick="hostShowAnswer()">正解を表示</button>
            <button id="btn-next" class="ctrl-btn btn-next hidden" onclick="hostNextQ()">次の問題へ</button>
            <button class="ctrl-btn btn-reset" onclick="resetGame()">RESET</button>
        </div>
    </div>
</div>

<!-- CLIENT SCREEN -->
<div id="view-client">
    <div class="client-container">
        <h1 class="reg-font" style="color:var(--accent-color);">参加画面</h1>

        <!-- Login -->
        <div id="login-area" class="name-input-area">
            <p>名前を入力してください</p>
            <input type="text" id="input-name" class="name-input" placeholder="例: たかし">
            <button class="mode-btn btn-client" onclick="clientJoin()">参加する！</button>
        </div>

        <!-- Waiting / Game -->
        <div id="client-main" class="hidden">
            <h2 id="client-status" style="margin-bottom:30px;"></h2>
            
            <div id="client-waiting" class="waiting-area">
                <div class="spinner"></div>
                <p>親機が開始するのを待っています...</p>
            </div>

            <div id="client-quiz" class="client-quiz-area hidden">
                <button class="ans-btn-client" onclick="clientSubmit(0)">A</button>
                <button class="ans-btn-client" onclick="clientSubmit(1)">B</button>
                <button class="ans-btn-client" onclick="clientSubmit(2)">C</button>
                <button class="ans-btn-client" onclick="clientSubmit(3)">D</button>
            </div>
            
            <div id="client-result" class="result-popup hidden">
                <div class="result-text win">⭕️ 正解！</div>
            </div>
        </div>
    </div>
</div>

<script>
    // Scoreboard Resize Logic
    const handle = document.querySelector('.resize-handle');
    const board = document.getElementById('host-scoreboard');
    let startY, startH;
    
    handle.addEventListener('mousedown', initDrag);
    handle.addEventListener('touchstart', initDrag);

    function initDrag(e) {
        startY = e.touches ? e.touches[0].clientY : e.clientY;
        startH = parseInt(window.getComputedStyle(board).height);
        document.addEventListener('mousemove', doDrag);
        document.addEventListener('touchmove', doDrag);
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
    }

    function doDrag(e) {
        const y = e.touches ? e.touches[0].clientY : e.clientY;
        const newH = startH + (startY - y);
        if(newH > 100 && newH < 600) board.style.height = newH + 'px';
    }

    function stopDrag() {
        document.removeEventListener('mousemove', doDrag);
        document.removeEventListener('touchmove', doDrag);
    }
</script>

</body>
</html>
